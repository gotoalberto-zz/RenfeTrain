<html>
	<head>
		<link href="js/resources/css/ext-all-gray.css" rel="stylesheet" type="text/css"/>
		<script src="js/ext-all.js" type="text/javascript"></script>
		<script src="js/locale/ext-lang-es.js" type="text/javascript"></script>
		<script type="text/javascript">
			Ext.define('Combo',{
				extend:'Ext.data.Model',
				fields:[
					{name: 'nombre',	type:'string'},
					{name: 'id',		type:'string'},
					{name: 'provincia',	type:'string'},
					{name: 'URL',		type:'string'}
				]
			});
		
			Ext.define('Grid',{
				extend:'Ext.data.Model',
				fields:[
					{name: 'id',			type: 'int'},
					{name: 'hora',			type:'time'},
					{name: 'procedencia',	type:'string'},
					{name: 'tren',			type:'string'},
					{name: 'indemnizacion',	type:'bool'}
				]
			});	
			 
			var dsStore = Ext.create('Ext.data.Store',{
				model: 'Grid',
				proxy: {
					type: 'ajax',
 					url: 'llegadas.do',
					reader: {
						type: 'json',
						root: 'items',
						totalProperty: 'totalCount'
					}
				}
			});
		
			Ext.onReady(function(){
				Ext.create("Ext.container.Viewport",{
					layout: 'border',
					padding: '20 20 20 20',
					items:[
						{
							xtype: 'form',
							id:'search',
							layout: 'column',
							title:'Buscador',
							height: 100,
							region: 'north',
							collapsed: false,
							items:[
								{
									columnWidth: .4,
									xtype: 'combo',
									id: 'estacion',
									name: 'estacion',
									margin: '15%',
									fieldLabel: 'Estaci&oacute;n',
									typeAhead: false,
									hideTrigger: false,
									allowBlank: true,
									queryDelay: 100,
									minChar: 2,
									valueField: 'id',
									displayField: 'nombre',
									triggerAction: 'all',
									mode: 'local',
									loadingText: 'Cargando...',
									store: {
										xtype: 'combostore',
										model: 'Combo',
										proxy: {
											type: 'ajax',
											url: 'json/estaciones.json',
											reader: {
												type: 'json',
												root: 'estacion',
												totalProperty: 'totalCount'
											}
										},
									}
								},
								{
									columnWidth: .4,
									xtype: 'datefield',
									margin: '15%',
									startDay: 1,
									id: 'fecha',
									name: 'fecha',
									fieldLabel: 'Fecha'
								},
								{
									columnWidth: .2,
									border: false,
									xtype: 'button',
									margin: '15%',
									text: 'Buscar',
									handler: function(){
										Ext.getCmp('listTrain').getStore().load({params: Ext.getCmp('search').getValues()});
									}		
								}
							]
						},
						{
							xtype: 'grid',
							id:'listTrain',
							title:'Listado de trenes',
							region: 'center',
							store: dsStore,
							columns:[
								{
									header: 'Hora de llegada',
									flex: .25,
									dataIndex: 'hora'
								},
								{
									header: 'Procedencia',
									flex: .25,
									dataIndex: 'procedencia'
								},
								{
									header: 'Numero de tren',
									flex: .25,
									dataIndex: 'tren'
								},
								{
									header: 'Derecho a Indemnizaci&oacute;n',
									flex: .25,
									dataIndex:'indemnizacion',
									renderer: function(value, cell){
										return value?'<div style="text-align: center;"><img src="ico/accept.png"></div>':'<div style="text-align: center;"><img src="ico/cancel.png"></div>'
									}
								}
							]
						}
					]
				});
			});
		</script>
	</head>
</html>
